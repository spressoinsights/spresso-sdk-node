name: CI
on:
    - pull_request
jobs:
    e2eTesting:
        runs-on: ubuntu-latest
        name: E2E Testing
        steps:
            - uses: actions/checkout@v3
            - name: Start minikube
              uses: medyagh/setup-minikube@master
            - name: Install Nix Package Manager
              uses: cachix/install-nix-action@v18
              with:
                  nix_path: nixpkgs=channel:nixos-22.05
            - name: Deploy to minikube
              run: nix-shell --command "make -f ./commands.nixwrap startServicesCI"
            - name: Install
              run: nix-shell --command "make -f ./commands.nixwrap install"
            - name: Local Publish
              run: nix-shell --command "make -f ./commands.nixwrap localPublish"
            - name: E2E Testing
              run: |
                  nix-shell --command "make -f ./commands.nixwrap installForE2ETesting"
                  nix-shell --command "make -f ./commands.nixwrap e2eTesting"
    unitTesting:
        runs-on: ubuntu-latest
        name: Unit Testing
        steps:
            - uses: actions/checkout@v3
            - name: Install Nix Package Manager
              uses: cachix/install-nix-action@v18
              with:
                  nix_path: nixpkgs=channel:nixos-22.05
            - name: Install
              run: nix-shell --command "make -f ./commands.nixwrap install"
            - name: Unit Testing
              run: nix-shell --command "make -f ./commands.nixwrap unitTesting"
